<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Invest Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    table { border-collapse: collapse; margin-top: 12px; min-width: 480px; }
    th, td { border: 1px solid #ddd; padding: 8px 10px; text-align: left; }
    th { background: #f0f0f0; }
    .positive { color: green; }
    .negative { color: #b00020; }
    .summary { display: flex; gap: 16px; flex-wrap: wrap; margin: 16px 0; }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 6px; min-width: 180px; background: #fafafa; }
  </style>
</head>
<body>
  <h1>Мой портфель</h1>

  <div class="summary">
    <div class="card">
      <div>Вложено</div>
      <strong>{{ '%.2f'|format(portfolio.invested or 0) }}</strong>
    </div>
    <div class="card">
      <div>Текущая стоимость</div>
      <strong>{{ '%.2f'|format(portfolio.value or 0) }}</strong>
    </div>
    <div class="card">
      <div>Прибыль</div>
      {% set p = portfolio.profit or 0 %}
      <strong class="{{ 'positive' if p >= 0 else 'negative' }}">{{ '%.2f'|format(p) }}</strong>
    </div>
  </div>

  <h2>Тикеры</h2>
  <table>
    <thead>
      <tr>
        <th>Тикер</th>
        <th>Сделок</th>
        <th>Кол-во</th>
        <th>Вложено</th>
        <th>Текущая цена</th>
        <th>Текущая стоимость</th>
        <th>Прибыль</th>
      </tr>
    </thead>
    <tbody>
      {% for t in tickers %}
        <tr>
          <td><a href="/ticker/{{t['ticker']}}">{{t['ticker']}}</a></td>
          <td>{{t['trades']}}</td>
          <td>{{ '%.4f'|format(t['qty'] or 0) }}</td>
          <td>{{ '%.2f'|format(t['invested'] or 0) }}</td>
          <td>
            {% if t['current_price'] is not none %}
              {{ '%.2f'|format(t['current_price']) }}
            {% else %}
              —
            {% endif %}
          </td>
          <td>
            {% if t['market_value'] is not none %}
              {{ '%.2f'|format(t['market_value']) }}
            {% else %}
              —
            {% endif %}
          </td>
          <td>
            {% if t['profit'] is not none %}
              {% set pr = t['profit'] %}
              <span class="{{ 'positive' if pr >= 0 else 'negative' }}">{{ '%.2f'|format(pr) }}</span>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr><td colspan="7">Нет сделок.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
